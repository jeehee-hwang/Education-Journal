- í”„ë¡œì íŠ¸ ê²Œì‹œíŒ 


1. BoardService.javaì˜ ë¬¸ì œì  ë° ìˆ˜ì • ì œì•ˆ
ê°€ì¥ ì‹œê¸‰í•˜ê³  ì¤‘ìš”í•œ ìˆ˜ì •ì´ í•„ìš”í•œ íŒŒì¼ì…ë‹ˆë‹¤.

1.1. createBoard ë©”ì†Œë“œ: ì—°ê´€ ê´€ê³„ ì„¤ì • ì˜¤ë¥˜ (ì¹˜ëª…ì )
ë¬¸ì œì :
createBoard ë©”ì†Œë“œ ë‚´ì—ì„œ BoardEntityë¥¼ ìƒì„±í•  ë•Œ, ì—°ê´€ëœ OrgEntityë¥¼ ì„¤ì •í•˜ëŠ” orgReference ë³€ìˆ˜ê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì•„ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. orgId íŒŒë¼ë¯¸í„°ë¥¼ ë°›ê³  ìˆì§€ë§Œ ì‹¤ì œ ë¡œì§ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.

í•´ê²° ë°©ì•ˆ:
orgIdë¥¼ ì‚¬ìš©í•´ OrgRepositoryì—ì„œ OrgEntityì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì¡°íšŒí•œ í›„, BoardEntityë¥¼ ìƒì„±í•  ë•Œ ì„¤ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. JpaRepositoryì˜ getReferenceById() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ì§€ ì•Šê³  í”„ë¡ì‹œ(ì°¸ì¡°)ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì–´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.

ìˆ˜ì • ì½”ë“œ ì˜ˆì‹œ:
OrgRepositoryë¥¼ ë¨¼ì € ì„œë¹„ìŠ¤ì— ì£¼ì…í•´ì•¼ í•©ë‹ˆë‹¤. (í•´ë‹¹ íŒŒì¼ì´ ì—†ìœ¼ë¯€ë¡œ ì¶”ê°€í–ˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.)

Java

package com.ourhour.domain.board.service;

import com.ourhour.domain.board.dto.BoardDTO;
import com.ourhour.domain.board.mapper.BoardMapper;
import com.ourhour.domain.board.dto.BoardResponseDTO;
import com.ourhour.domain.board.entity.BoardEntity;
import com.ourhour.domain.board.repository.BoardRepository;
import com.ourhour.domain.org.entity.OrgEntity;
import com.ourhour.domain.org.repository.OrgRepository; // OrgRepository import ì¶”ê°€
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors; // Stream API import

@Service
@RequiredArgsConstructor
public class BoardService {

    private final BoardRepository boardRepository;
    private final OrgRepository orgRepository; // OrgRepository ì£¼ì…
    private final BoardMapper boardMapper;

    // ... (getBoardList ë©”ì†Œë“œ)

    @Transactional // ë°ì´í„° ë³€ê²½ì´ ìˆìœ¼ë¯€ë¡œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬
    public BoardResponseDTO createBoard(Long orgId, BoardDTO create) {
        // orgIdë¥¼ ì‚¬ìš©í•˜ì—¬ OrgEntity ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜´
        OrgEntity orgEntity = orgRepository.getReferenceById(orgId);

        BoardEntity newBoard = BoardEntity.builder()
                .name(create.getName())
                .isFixed(create.isFixed())
                .orgEntity(orgEntity) // ê°€ì ¸ì˜¨ ì°¸ì¡°ë¡œ OrgEntity ì„¤ì •
                .build();

        boardRepository.save(newBoard);
        return boardMapper.toBoardResponseDTO(newBoard);
    }

    // ... (ì´í•˜ ì½”ë“œ)
}

1.2. modifyBoard ë©”ì†Œë“œ: íŠ¸ëœì­ì…˜ ë¶€ì¬ ë° ì˜ˆì™¸ ì²˜ë¦¬ ë¯¸í¡
ë¬¸ì œì :
@Transactional ì–´ë…¸í…Œì´ì…˜ì´ ì—†ì–´ JPAì˜ ë”í‹° ì²´í‚¹(Dirty Checking) ê¸°ëŠ¥ì´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, boardEntity.update(...)ë¥¼ í˜¸ì¶œí•´ë„ ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ì´ ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ê²Œì‹œíŒ ID(boardId)ë¡œ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆì„ ë•Œ nullì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ ê²½ìš° ControllerëŠ” 200 OKì™€ í•¨ê»˜ ë¹„ì–´ìˆëŠ” bodyë¥¼ ì‘ë‹µí•˜ê²Œ ë˜ì–´, í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ ì„±ê³µì¸ì§€ ì‹¤íŒ¨ì¸ì§€ ëª…í™•íˆ ì•Œê¸° ì–´ë µìŠµë‹ˆë‹¤.

í•´ê²° ë°©ì•ˆ:
ë©”ì†Œë“œì— @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ì—¬ ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì´ ë™ì‘í•˜ë„ë¡ í•©ë‹ˆë‹¤.
findByIdë¡œ ì¡°íšŒí•œ ê²°ê³¼ê°€ ì—†ì„ ê²½ìš° null ëŒ€ì‹ , ì§ì ‘ ë§Œë“œì‹  BoardExceptionì´ë‚˜ EntityNotFoundException ê°™ì€ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œ 404 Not Found ì‘ë‹µì„ ìœ ë„í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ìˆ˜ì • ì½”ë“œ ì˜ˆì‹œ:
// BoardService.java ë‚´
import com.ourhour.domain.board.exceptions.BoardException; // ì˜ˆì™¸ import
import jakarta.persistence.EntityNotFoundException; // í˜¹ì€ JPA ì˜ˆì™¸ ì‚¬ìš©

// ...

@Transactional // íŠ¸ëœì­ì…˜ ì¶”ê°€
public BoardResponseDTO modifyBoard(Long boardId, BoardDTO request) {
    // findById ëŒ€ì‹  orElseThrowë¥¼ ì‚¬ìš©í•˜ì—¬ ì—†ì„ ê²½ìš° ì˜ˆì™¸ ë°œìƒ
    BoardEntity boardEntity = boardRepository.findById(boardId)
            .orElseThrow(() -> new EntityNotFoundException("í•´ë‹¹ IDì˜ ê²Œì‹œíŒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + boardId));
            // í˜¹ì€ .orElseThrow(BoardException::boardNotFoundException); ì™€ ê°™ì´ ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì‚¬ìš©

    // update ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œ ìë™ìœ¼ë¡œ DBì— ë°˜ì˜ë¨
    boardEntity.update(request.getName(), request.isFixed());

    // boardRepository.save()ë¥¼ í˜¸ì¶œí•  í•„ìš” ì—†ìŒ
    return boardMapper.toBoardResponseDTO(boardEntity);
}

1.3. deleteBoard ë©”ì†Œë“œ: ì˜ˆì™¸ ì²˜ë¦¬ ë¯¸í¡
ë¬¸ì œì :
modifyBoardì™€ ìœ ì‚¬í•˜ê²Œ, ì‚­ì œí•  ê²Œì‹œíŒì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šê³  ì •ìƒ ì‘ë‹µ(200 OK)ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ëŠ” API ì‚¬ìš©ìì—ê²Œ í˜¼ë€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•´ê²° ë°©ì•ˆ:
deleteByIdëŠ” IDê°€ ì—†ì„ ê²½ìš° EmptyResultDataAccessExceptionì„ ë°œìƒì‹œí‚µë‹ˆë‹¤. ì´ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜, ë” ëª…í™•í•œ ì œì–´ë¥¼ ìœ„í•´ findByIdë¡œ ë¨¼ì € ì¡°íšŒ í›„ ì‚­ì œí•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìˆ˜ì • ì½”ë“œ ì˜ˆì‹œ:
// BoardService.java ë‚´

@Transactional // íŠ¸ëœì­ì…˜ ì¶”ê°€
public void deleteBoard(Long boardId) {
    // ë¨¼ì € ì—”í‹°í‹°ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    BoardEntity board = boardRepository.findById(boardId)
            .orElseThrow(() -> new EntityNotFoundException("í•´ë‹¹ IDì˜ ê²Œì‹œíŒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + boardId));
    
    // ì¡´ì¬í•˜ë©´ ì‚­ì œ
    boardRepository.delete(board);
}

1.4. getBoardList ë©”ì†Œë“œ: ì½”ë“œ ê°„ì†Œí™” ì œì•ˆ
ë¬¸ì œì :
í˜„ì¬ ë¡œì§ì€ ê¸°ëŠ¥ì ìœ¼ë¡œ ë¬¸ì œê°€ ì—†ì§€ë§Œ, Java Stream APIë¥¼ ì‚¬ìš©í•˜ë©´ ë” ê°„ê²°í•˜ê³  ê°€ë…ì„± ë†’ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ê²° ë°©ì•ˆ:
// BoardService.java ë‚´

@Transactional(readOnly = true) // ì¡°íšŒ ì „ìš© íŠ¸ëœì­ì…˜
public List<BoardResponseDTO> getBoardList(Long orgId) {
    return boardRepository.findAllByOrgEntity_OrgId(orgId)
            .stream()
            .map(boardMapper::toBoardResponseDTO) // Entityë¥¼ DTOë¡œ ë§¤í•‘
            .collect(Collectors.toList()); // Listë¡œ ë³€í™˜
}

2. BoardException.java
ê²€í†  ì˜ê²¬:
authorNotFoundExceptionì´ë¼ëŠ” ì •ì  ë©”ì†Œë“œëŠ” 'ê²Œì‹œíŒ(Board)' ë„ë©”ì¸ì˜ ì˜ˆì™¸ì™€ëŠ” ë‹¤ì†Œ ê±°ë¦¬ê°€ ìˆì–´ ë³´ì…ë‹ˆë‹¤. ì•„ë§ˆ 'ê²Œì‹œê¸€(Post)'ì´ë‚˜ ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ ì‚¬ìš©ë  ë²•í•œ ë‚´ìš©ì…ë‹ˆë‹¤. BoardNotFoundExceptionê³¼ ê°™ì´ ê²Œì‹œíŒ ë„ë©”ì¸ì— ë” ì í•©í•œ ì˜ˆì™¸ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒì´ ì¢‹ì•„ ë³´ì…ë‹ˆë‹¤.

ìˆ˜ì • ì œì•ˆ:
package com.ourhour.domain.board.exceptions;

import com.ourhour.global.exception.BusinessException;
import org.springframework.http.HttpStatus;

public class BoardException extends BusinessException {
    public BoardException(int status, String message) {
        super(status, message);
    }

    public static BoardException boardNotFoundException() {
        return new BoardException(HttpStatus.NOT_FOUND.value(), "í•´ë‹¹ ê²Œì‹œíŒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
}

3. ê·¸ ì™¸ íŒŒì¼ë“¤ (Entity, Controller, Repository, DTO, Mapper)
ì œê³µí•´ì£¼ì‹  ë‹¤ë¥¸ íŒŒì¼ë“¤ì€ ì—­í• ì— ë§ê²Œ ì˜ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

BoardEntity.java: @ManyToOne ì—°ê´€ ê´€ê³„ ì„¤ì •ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤.
BoardRepository.java: Spring Data JPAì˜ ì¿¼ë¦¬ ë©”ì†Œë“œ(findAllByOrgEntity_OrgId) ëª…ëª… ê·œì¹™ì„ ì˜ ë”°ë¥´ê³  ìˆìŠµë‹ˆë‹¤.
BoardController.java: ê° HTTP ë©”ì†Œë“œì— ë§ê²Œ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì˜ ì„¤ê³„í–ˆìœ¼ë©°, Serviceë¥¼ í˜¸ì¶œí•˜ëŠ” ì—­í• ì— ì¶©ì‹¤í•©ë‹ˆë‹¤.
BoardDTO.java, BoardResponseDTO.java: ìš”ì²­/ì‘ë‹µì— ë”°ë¥¸ ë°ì´í„° ë¶„ë¦¬(DTO íŒ¨í„´)ë¥¼ ì˜ ì ìš©í–ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ BoardDTOì˜ postCount í•„ë“œëŠ” ê²Œì‹œíŒ ìƒì„±/ìˆ˜ì • ì‹œ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì´ í•„ë“œì˜ ìš©ë„ë¥¼ ëª…í™•íˆ í•˜ê±°ë‚˜ ë‹¤ë¥¸ DTOë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
BoardMapper.java: MapStructë¥¼ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µì ì¸ ë³€í™˜ ë¡œì§ì„ ìë™í™”í•œ ì ì´ ì¢‹ìŠµë‹ˆë‹¤.

ìµœì¢… ìš”ì•½
BoardServiceì˜ createBoardì—ì„œ OrgEntity ì—°ê´€ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë¡œì§ì„ ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. (ê°€ì¥ ì¤‘ìš”)
ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ì„œë¹„ìŠ¤ ë©”ì†Œë“œ(create, modify, delete)ì— @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨ ì‹œ null ë°˜í™˜ ëŒ€ì‹  ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œ Controllerì—ì„œ 404ì™€ ê°™ì€ ëª…í™•í•œ ì‹¤íŒ¨ ì‘ë‹µì„ ì£¼ë„ë¡ ê°œì„ í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
Java Stream APIë¥¼ í™œìš©í•˜ì—¬ ì½”ë“œë¥¼ ë” ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

=======================================
ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œ 

** Controller
@RestController
@RequestMapping("/api/organizations")
@RequiredArgsConstructor
public class BoardController {

    private final BoardService boardService;

    //ê²Œì‹œíŒ ì „ì²´ ëª©ë¡ ì¡°íšŒ
    @GetMapping("/{orgId}/boards")
    public ResponseEntity<ApiResponse<List<BoardResponseDTO>>> getBoardList(@OrgId @PathVariable Long orgId) {
        List<BoardResponseDTO> boardResponseDTOList = boardService.getBoardList(orgId);
        ApiResponse<List<BoardResponseDTO>> apiResponse = ApiResponse.success(boardResponseDTOList);
        return ResponseEntity.ok(apiResponse);
    }

    // ê²Œì‹œíŒ ë“±ë¡
    @PostMapping("/{orgId}/boards" )
    public ResponseEntity<ApiResponse<BoardResponseDTO>> createBoard(@OrgId @PathVariable Long orgId, @RequestBody BoardDTO create) {
        BoardResponseDTO newBoard = boardService.createBoard(orgId, create);
        ApiResponse<BoardResponseDTO> apiResponse = ApiResponse.success(newBoard);
        return ResponseEntity.ok(apiResponse);
    }

   //ê²Œì‹œíŒ ìˆ˜ì •
    @PutMapping("/{orgId}/boards/{boardId}")
    public ResponseEntity<ApiResponse<BoardResponseDTO>> modifyBoard(@OrgId @PathVariable Long orgId, @PathVariable Long boardId, @RequestBody BoardDTO modify) {
        BoardResponseDTO boardResponseDTO = boardService.modifyBoard(boardId, modify);
        return ResponseEntity.ok(ApiResponse.success(boardResponseDTO));
    }

  // ê²Œì‹œíŒ ì‚­ì œ
    @DeleteMapping("/{orgId}/boards/{boardId}")
    public ResponseEntity<ApiResponse<Void>> deleteBoard(@OrgId @PathVariable Long orgId, @PathVariable Long boardId) {
        boardService.deleteBoard(boardId);
        return ResponseEntity.ok(ApiResponse.success(null));
    }
}

** BoardDTO
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class BoardDTO {

    private Long boardId;
    private String name;
    private Long postCount;
    private boolean isFixed;
}

** BoardResponseDTO
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Setter
public class BoardResponseDTO {
    private Long boardId;
    private String name;
}

**  BoardEntity 
@Entity
@Table(name = "tbl_board")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class BoardEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long boardId;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "org_id", nullable = false)
    private OrgEntity orgEntity;

    private String name;

    private boolean isFixed;

    public void update(String name, boolean isFixed) {
        this.name = name;
        this.isFixed = isFixed;
    }
}

** BoardException
public class BoardException extends BusinessException {
    public BoardException(int status, String message) {
        super(status, message);
    }
    public static BoardException authorNotFoundException() {
        return new BoardException(404, "í•´ë‹¹ ì‘ì„±ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
}

** Mapper 
@Mapper(componentModel = "spring")
public interface BoardMapper {
    // Entity -> DTO
    BoardResponseDTO toBoardResponseDTO(BoardEntity boardEntity);
}

** BoardRepository 
@Repository
public interface BoardRepository extends JpaRepository<BoardEntity, Long> {
    List<BoardEntity> findAllByOrgEntity_OrgId(Long orgId);
}

** BoardService
@Service
@RequiredArgsConstructor
public class BoardService {

    private final BoardRepository boardRepository;
    private final BoardMapper boardMapper;

    // ê²Œì‹œíŒ ëª©ë¡ ì¡°íšŒ
    public List<BoardResponseDTO> getBoardList(Long orgId) {
        List<BoardEntity> boardEntityList = boardRepository.findAllByOrgEntity_OrgId(orgId);
        List<BoardResponseDTO> boardResponseDTOList = new ArrayList<>();
        for (BoardEntity boardEntity : boardEntityList) {
            BoardResponseDTO boardResponseDTO = boardMapper.toBoardResponseDTO(boardEntity);
            boardResponseDTOList.add(boardResponseDTO);
            System.out.println("boardResponseDTO.getBoardId() = " + boardResponseDTO.getBoardId());
            System.out.println("boardResponseDTO.getBoardId() = " + boardResponseDTO.getName());
        }
        return boardResponseDTOList;
    }


    public BoardResponseDTO createBoard(Long orgId, BoardDTO create) { // ğŸ‘ˆ [í•´ê²°] 5. orgId íŒŒë¼ë¯¸í„° ì¶”ê°€
        BoardEntity newBoard = BoardEntity.builder()
                .name(create.getName())
                .isFixed(create.isFixed())
                .orgEntity(orgReference) // orgEntityë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
                .build();
        boardRepository.save(newBoard);
        return boardMapper.toBoardResponseDTO(newBoard);
    }

    // ê²Œì‹œíŒ ìˆ˜ì •
    public BoardResponseDTO modifyBoard(Long boardId, BoardDTO request) {
        Optional<BoardEntity> optionalBoard = boardRepository.findById(boardId);
        if (optionalBoard.isPresent()) {
            BoardEntity boardEntity = optionalBoard.get();
            boardEntity.update(request.getName(), request.isFixed());
            BoardResponseDTO boardResponseDTO = boardMapper.toBoardResponseDTO(boardEntity);
            return boardResponseDTO;
        }
        return null;
    }

    // ê²Œì‹œíŒ ì‚­ì œ
    public void deleteBoard(Long boardId) {
        boolean isExists = boardRepository.existsById(boardId);
        if (isExists) {
            boardRepository.deleteById(boardId);
        }
    }
}
